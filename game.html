<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
    content="width=device-width,height=device-height,
                 initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>せいの - game</title>
    
    <style>
      html, body {
        margin: 0;
        height: 100%;
        background: #000;
        font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
        overflow: hidden;
      }
      
      :root{
        /* ★ここだけ触れば全体の濃さが変わる */
        --win-alpha: 0.12;      /* 背景透明度：極薄 */
        --win-blur: 10px;       /* ぼかし：薄い窓の支え */
        --win-border: 0.10;     /* 枠の薄さ */
        
        --name-size: 14px;
        --text-size: 16px;
        --name-lh: 1.25;
        --text-lh: 1.65;
        
        --pad-y: 14px;
        --pad-x: 16px;
      }
      
      /* =====================
       全画面画像
       ===================== */
      #stage {
        position: fixed;
        inset: 0;
        background: #000;
      }
      
      #gameFrame {
        position: absolute;
        inset: 0;
        background: #000;
        overflow: hidden;
      }
      
      #sceneImage {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background: #000;
      }
      
      /* 演出 */
      #fadeLayer, #flashLayer{
        position: absolute;
        inset: 0;
        pointer-events: none;
      }
      #fadeLayer{
        background: #000;
        opacity: 0;
        transition: opacity 200ms linear;
      }
      #flashLayer{
        background: #fff;
        opacity: 0;
      }
      
      /* UI */
      #uiBar {
        position: absolute;
        top: 12px;
        right: 12px;
        display: flex;
        gap: 8px;
        z-index: 20;
      }
      .uiBtn {
        all: unset;
        cursor: pointer;
        padding: 8px 10px;
        border-radius: 10px;
        background: rgba(0,0,0,.30);
        color: rgba(255,255,255,.88);
        font-size: 13px;
        -webkit-tap-highlight-color: transparent;
        text-shadow: 0 1px 2px rgba(0,0,0,.9);
      }
      .uiBtn:active { transform: scale(0.97); }
      
      #startButton {
        position: absolute;
        left: 50%;
        top: 55%;
        transform: translate(-50%, -50%);
        padding: 12px 20px;
        border-radius: 999px;
        background: rgba(255,255,255,.12);
        color: rgba(255,255,255,.95);
        font-weight: 700;
        letter-spacing: .05em;
        z-index: 25;
        -webkit-tap-highlight-color: transparent;
        text-shadow: 0 1px 2px rgba(0,0,0,.9);
      }
      #startButton:active { transform: translate(-50%, -50%) scale(0.98); }
      
      /* =====================
       透明ウィンドウ（画面内に組み込む）
       ===================== */
      #textWindow{
        position: absolute;
        left: 4%;
        right: 4%;
        bottom: 3%;
        z-index: 30;
        
        padding: var(--pad-y) var(--pad-x);
        border-radius: 16px;
        
        background: rgba(0,0,0,var(--win-alpha));
        border: 1px solid rgba(255,255,255,var(--win-border));
        box-shadow: 0 12px 36px rgba(0,0,0,.35);
        
        backdrop-filter: blur(var(--win-blur));
        -webkit-backdrop-filter: blur(var(--win-blur));
        
        /* ★窓の最大高さ（多すぎると邪魔なので） */
        max-height: 32vh;
        overflow: hidden;
      }
      
      #nameBox{
        font-size: var(--name-size);
        line-height: var(--name-lh);
        font-weight: 700;
        margin-bottom: 8px;
        
        color: rgba(255,255,255,.92);
        text-shadow:
          0 2px 4px rgba(0,0,0,.95),
          0 0 1px rgba(0,0,0,.95);
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
      
      #textBox{
        font-size: var(--text-size);
        line-height: var(--text-lh);
        white-space: pre-wrap;
        
        color: rgba(255,255,255,.95);
        text-shadow:
          0 2px 6px rgba(0,0,0,.95),
          0 0 1px rgba(0,0,0,.95);
        
        /* ★本文は窓内に収める */
        overflow: hidden;
      }
    </style>
  </head>
  
  <body>
    <div id="stage">
      <div id="gameFrame">
        <img id="sceneImage" alt="scene" src="">
        <div id="flashLayer"></div>
        <div id="fadeLayer"></div>
        
        <div id="uiBar">
          <button class="uiBtn" id="prevButton">戻る</button>
          <button class="uiBtn" id="nextButton">次へ</button>
        </div>
        
        <button id="startButton">開始</button>
        
        <div id="textWindow">
          <div id="nameBox"></div>
          <div id="textBox"></div>
        </div>
      </div>
    </div>
    
    <audio id="bgm" loop playsinline></audio>
    <audio id="rse" loop playsinline></audio>
    <audio id="se" playsinline></audio>
    <audio id="voice" playsinline></audio>
    
    <script>
      const params = new URLSearchParams(location.search);
      const scenario = params.get("scenario") || "umae";
      
      const load = (src) => new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.onload = resolve;
          s.onerror = () => reject(new Error("load failed: " + src));
          document.head.appendChild(s);
      });
      
      (async () => {
          try {
            try { await load("config.js"); } catch {}
            await load("game.js");
            
            if (typeof window.bootGame !== "function") {
              alert("bootGame が存在しない");
              return;
            }
            
            await window.bootGame({
                packsRoot: "packs",
                scenario,
                saveKeyPrefix: scenario + "_",
            });
          } catch (e) {
            alert("起動失敗: " + (e?.message ?? String(e)));
            console.error(e);
          }
      })();
    </script>
  </body>
</html>
